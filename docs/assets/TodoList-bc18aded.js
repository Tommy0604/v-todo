import{d as P,b3 as H,r as $,H as W,a as T,c as g,b as _,w as L,u as n,B as G,aP as k,aM as u,aQ as F,aN as M,aO as V,F as R,ai as m,aY as z,a$ as Q,aS as K,b2 as X,aH as Z,A as b,z as ee,Y as te,aU as oe,bd as ne,R as se}from"./index-8b3cc893.js";import{c as ae,d as ie,e as J}from"./footer-0adfa1ab.js";import{C as re}from"./index-aa89fd50.js";const de={class:"content"},le={class:"meta-data-info-group"},ce={key:0,class:"meta-data-info"},ue={class:"todo-info__label"},me={key:1,class:"meta-data-info"},pe={class:"todo-info__reminder"},_e={class:"todo-info__label"},fe={key:2,class:"meta-data-info"},ve={class:"todo-info__date"},Te={class:"todo-info__label"},ge={name:"TodoItem"},he=P({...ge,props:{data:{}},emits:["onRemove"],setup(w,{emit:f}){let{calendarPipe:x,overduePipe:U}=H();const C=f;let N=w,y=$(!1),s=W(N.data);const i=r=>m(r.overdueTime||null)>m()||m(r.completionTime||null).isToday()?"dueToday":m(r.overdueTime)<m()?"overdue":"",h=(r,l)=>{l.done=!l.done,l.completionTime=l.done?m().format():""},d=()=>{y.value=!0},S=r=>C("onRemove",r),E=r=>{y.value=!1,s.done=r.done,s.title=r.title,s.overdueTime=r.overdueTime,s.remindTime=r.remindTime,s.repeatType=r.repeatType,s.createTime=r.createTime};return(r,l)=>{const A=re,I=z,O=Q,e=ie;return T(),g(R,null,[_(e,{trigger:["contextmenu"],overlayClassName:"content"},{overlay:L(()=>[_(O,null,{default:L(()=>[_(I,{key:"1",onClick:l[1]||(l[1]=t=>S(n(s).id))},{default:L(()=>[G(k(r.$t("delete_task")),1)]),_:1})]),_:1})]),default:L(()=>{var t;return[u("div",de,[_(A,{onChange:l[0]||(l[0]=o=>h(o,n(s))),checked:n(s).done},null,8,["checked"]),u("button",{class:"todo-item__title-wrapper",onClick:d},[u("span",{class:F({done:n(s).done})},k((t=n(s))==null?void 0:t.title),3),u("div",le,[n(s).overdueTime?(T(),g("span",ce,[u("span",{class:F(["todo-info__date",i(n(s))])},[_(n(M),{type:"icon-calendar",style:{"font-size":"1.6rem"}}),u("span",ue,k(n(U)(n(s).overdueTime)),1)],2)])):V("",!0),n(s).remindTime?(T(),g("span",me,[u("span",pe,[_(n(M),{type:"icon-remind",style:{"font-size":"1.6rem"}}),u("span",_e,k(n(x)(n(s).remindTime)),1)])])):V("",!0),n(s).completionTime?(T(),g("span",fe,[u("span",ve,[_(n(M),{type:"icon-sun"}),u("span",Te,k(n(x)(n(s).remindTime)),1)])])):V("",!0)])])])]}),_:1}),_(n(ae),{visible:n(y),todo:n(s),onClose:E},null,8,["visible","todo"])],64)}}});const ye=K(he,[["__scopeId","data-v-ba6458a7"]]),ke={key:0},be={key:1,class:"flex-center empty"},Le=u("lottie-player",{src:"https://assets5.lottiefiles.com/packages/lf20_iikbn1ww.json",background:"rgba(0, 0, 0, 0)",speed:"1",style:{width:"300px",height:"300px"},loop:"",autoplay:""},null,-1),Ie=[Le],Ne=P({__name:"TodoList",props:{isSort:{}},setup(w){let{todos:f,clear:x,showModal:U,addTodo:C}=X();const N=se(),y=w;let s=Z(),i=$([]),h=$(!1),d;b(s,e=>{var o;((o=e==null?void 0:e.name)==null?void 0:o.toString())&&d&&d.terminate()}),b([s,f.value,f],([e,t],[o,a])=>{var v,c;const p=(v=e==null?void 0:e.name)==null?void 0:v.toString();(c=o==null?void 0:o.name)==null||c.toString(),p&&E(p)},{immediate:!0}),b(()=>y.isSort,(e,t)=>A(e?"asc":"desc"),{immediate:!0}),b(h,()=>I()),ee(()=>{I();const e=document.querySelectorAll(".todoItem"),t=document.querySelectorAll(".container");e.forEach(a=>{a.addEventListener("dragstart",()=>{a.classList.add("is-dragging")}),a.addEventListener("dragend",()=>{a.classList.remove("is-dragging")})}),t.forEach(a=>{a.addEventListener("dragover",p=>{p.preventDefault();const v=o(a,p.clientY),c=document.querySelector(".is-dragging");v?c&&a.insertBefore(c,v):c&&a.appendChild(c)})});const o=(a,p)=>{const v=a.querySelectorAll(".todoItem:not(.is-dragging)");let c,B=Number.NEGATIVE_INFINITY;return v.forEach(q=>{const{top:Y,height:j}=q.getBoundingClientRect(),D=p-(Y+j/2);D<0&&D>B&&(B=D,c=q)}),c}});function S(){d&&d.terminate(),d=new Worker(new URL(""+new URL("worker-6f7802eb.js",import.meta.url).href,self.location),{type:"module"}),d.addEventListener("message",e=>{O(e.data)})}function E(e){switch(e){case J.COMPLETED:i.value=f.value.filter(t=>t.done);break;case J.ALL:i.value=f.value.concat();break;default:i.value=f.value.filter(t=>t.type.toLocaleString()===e&&!t.done&&!t.overdue),i.value.forEach(t=>{t.remindTime&&!t.reminded&&r(t)});break}h.value=!h.value}function r(e){let t=new Date,o,a=(60-t.getSeconds())*1e3;const p=()=>{+m()>=+m(e.remindTime)&&!e.reminded&&(e.reminded=!0,new Audio(new URL(""+new URL("popup-aa1085ba.wav",import.meta.url).href,self.location).href).play(),clearInterval(o))};setTimeout(()=>{p(),o=setInterval(p,3e4)},a)}function l(e){const t=i.value.findIndex(a=>a.id===e),o=f.value.findIndex(a=>a.id===e);t>=0&&i.value.splice(t,1),o>=0&&f.value.splice(o,1)}function A(e){i.value=i.value.sort((t,o)=>(e==="asc"?m(t.createTime).isAfter(o.createTime):m(o.createTime).isAfter(t.createTime))?1:-1)}function I(){if(i.value.findIndex(t=>!!t.repeatType)>=0&&typeof Worker<"u"){S(),b(i,()=>{d.postMessage({type:"update",todoList:JSON.parse(JSON.stringify(i.value))})},{flush:"post"});const t={type:"start",todoList:JSON.parse(JSON.stringify(i.value))};d.postMessage(t),te(()=>{d.postMessage({type:"stop"})},N)}}const O=e=>{let t={...e,overdueTime:void 0,createTime:void 0,remindTime:void 0,reminded:void 0};i.value.forEach(o=>{o.id===e.id&&(console.log("input id:",e.id,"\rtodo:",o),o.overdue=!0,o.overdueTime=m().format())}),C(t),h.value=!h.value};return(e,t)=>n(i).length?(T(),g("div",ke,[_(ne,{name:"flip-list",tag:"ul",class:"container"},{default:L(()=>[(T(!0),g(R,null,oe(n(i),(o,a)=>(T(),g("div",{class:"todoItem",draggable:"true",key:o.id},[_(ye,{data:o,onOnRemove:l},null,8,["data"])]))),128))]),_:1})])):(T(),g("div",be,Ie))}});export{Ne as default};
//# sourceMappingURL=TodoList-bc18aded.js.map

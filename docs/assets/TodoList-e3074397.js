import{d as j,C as G,r as M,k as Y,a as T,c as g,b as _,w as L,u as n,q as z,t as k,m as u,v as F,I as V,p as $,b7 as H,F as P,K as m,b3 as K,b6 as Q,y as X,z as Z,f as ee,g as b,l as te,Q as oe,a$ as ne,b8 as se,a6 as ae}from"./index-f4f2c4d9.js";import{T as J}from"./todo-ceed345c.js";import{C as ie}from"./index-1803f182.js";import{D as re}from"./index-7e2aa7d1.js";const de={class:"content"},le={class:"meta-data-info-group"},ce={key:0,class:"meta-data-info"},ue={class:"todo-info__label"},me={key:1,class:"meta-data-info"},pe={class:"todo-info__reminder"},_e={class:"todo-info__label"},fe={key:2,class:"meta-data-info"},ve={class:"todo-info__date"},Te={class:"todo-info__label"},ge={name:"TodoItem"},ye=j({...ge,props:{data:{}},emits:["onRemove"],setup(C,{emit:x}){const f=C;let{calendarPipe:N,overduePipe:U}=G(),h=M(!1),s=Y(f.data);const I=r=>m(r.overdueTime||null)>m()||m(r.completionTime||null).isToday()?"dueToday":m(r.overdueTime)<m()?"overdue":"",i=(r,l)=>{l.done=!l.done,l.completionTime=l.done?m().format():""},y=()=>{h.value=!0},d=r=>x("onRemove",r),S=r=>{h.value=!1,s.done=r.done,s.title=r.title,s.overdueTime=r.overdueTime,s.remindTime=r.remindTime,s.repeatType=r.repeatType,s.createTime=r.createTime};return(r,l)=>{const E=ie,A=K,w=Q,D=re;return T(),g(P,null,[_(D,{trigger:["contextmenu"],overlayClassName:"content"},{overlay:L(()=>[_(w,null,{default:L(()=>[_(A,{key:"1",onClick:l[1]||(l[1]=e=>d(n(s).id))},{default:L(()=>[z(k(r.$t("delete_task")),1)]),_:1})]),_:1})]),default:L(()=>{var e;return[u("div",de,[_(E,{onChange:l[0]||(l[0]=t=>i(t,n(s))),checked:n(s).done},null,8,["checked"]),u("button",{class:"todo-item__title-wrapper",onClick:y},[u("span",{class:F({done:n(s).done})},k((e=n(s))==null?void 0:e.title),3),u("div",le,[n(s).overdueTime?(T(),g("span",ce,[u("span",{class:F(["todo-info__date",I(n(s))])},[_(n(V),{type:"icon-calendar",style:{"font-size":"1.6rem"}}),u("span",ue,k(n(U)(n(s).overdueTime)),1)],2)])):$("",!0),n(s).remindTime?(T(),g("span",me,[u("span",pe,[_(n(V),{type:"icon-remind",style:{"font-size":"1.6rem"}}),u("span",_e,k(n(N)(n(s).remindTime)),1)])])):$("",!0),n(s).completionTime?(T(),g("span",fe,[u("span",ve,[_(n(V),{type:"icon-sun"}),u("span",Te,k(n(N)(n(s).remindTime)),1)])])):$("",!0)])])])]}),_:1}),_(n(H),{visible:n(h),todo:n(s),onClose:S},null,8,["visible","todo"])],64)}}});const he=X(ye,[["__scopeId","data-v-01a5aa6b"]]),ke={key:0},be={key:1,class:"flex-center empty"},Le=u("lottie-player",{src:"https://assets5.lottiefiles.com/packages/lf20_iikbn1ww.json",background:"rgba(0, 0, 0, 0)",speed:"1",style:{width:"300px",height:"300px"},loop:"",autoplay:""},null,-1),Ie=[Le],Se=j({__name:"TodoList",props:{isSort:{}},setup(C){const x=C;let{todos:f,clear:N,showModal:U,addTodo:h}=Z();const s=ae();let I=ee(),i=M([]),y=M(!1),d;b(I,e=>{var o;((o=e==null?void 0:e.name)==null?void 0:o.toString())&&d&&d.terminate()}),b([I,f.value,f],([e,t],[o,a])=>{var v,c;const p=(v=e==null?void 0:e.name)==null?void 0:v.toString();(c=o==null?void 0:o.name)==null||c.toString(),p&&r(p)},{immediate:!0}),b(()=>x.isSort,(e,t)=>A(e?"asc":"desc"),{immediate:!0}),b(y,()=>w()),te(()=>{w();const e=document.querySelectorAll(".todoItem"),t=document.querySelectorAll(".container");e.forEach(a=>{a.addEventListener("dragstart",()=>{a.classList.add("is-dragging")}),a.addEventListener("dragend",()=>{a.classList.remove("is-dragging")})}),t.forEach(a=>{a.addEventListener("dragover",p=>{p.preventDefault();const v=o(a,p.clientY),c=document.querySelector(".is-dragging");v?c&&a.insertBefore(c,v):c&&a.appendChild(c)})});const o=(a,p)=>{const v=a.querySelectorAll(".todoItem:not(.is-dragging)");let c,q=Number.NEGATIVE_INFINITY;return v.forEach(B=>{const{top:R,height:W}=B.getBoundingClientRect(),O=p-(R+W/2);O<0&&O>q&&(q=O,c=B)}),c}});function S(){d&&d.terminate(),d=new Worker(new URL(""+new URL("worker-eb366d18.js",import.meta.url).href,self.location),{type:"module"}),d.addEventListener("message",e=>{D(e.data)})}function r(e){switch(e){case J.COMPLETED:i.value=f.value.filter(t=>t.done);break;case J.ALL:i.value=f.value.concat();break;default:i.value=f.value.filter(t=>t.type.toLocaleString()===e&&!t.done&&!t.overdue),i.value.forEach(t=>{t.remindTime&&!t.reminded&&l(t)});break}y.value=!y.value}function l(e){let t=new Date,o,a=(60-t.getSeconds())*1e3;const p=()=>{+m()>=+m(e.remindTime)&&!e.reminded&&(e.reminded=!0,new Audio(new URL(""+new URL("popup-aa1085ba.wav",import.meta.url).href,self.location).href).play(),clearInterval(o))};setTimeout(()=>{p(),o=setInterval(p,3e4)},a)}function E(e){const t=i.value.findIndex(a=>a.id===e),o=f.value.findIndex(a=>a.id===e);t>=0&&i.value.splice(t,1),o>=0&&f.value.splice(o,1)}function A(e){i.value=i.value.sort((t,o)=>(e==="asc"?m(t.createTime).isAfter(o.createTime):m(o.createTime).isAfter(t.createTime))?1:-1)}function w(){if(i.value.findIndex(t=>!!t.repeatType)>=0&&typeof Worker<"u"){S(),b(i,()=>{d.postMessage({type:"update",todoList:JSON.parse(JSON.stringify(i.value))})},{flush:"post"});const t={type:"start",todoList:JSON.parse(JSON.stringify(i.value))};d.postMessage(t),oe(()=>{d.postMessage({type:"stop"})},s)}}const D=e=>{let t={...e,overdueTime:void 0,createTime:void 0,remindTime:void 0,reminded:void 0};i.value.forEach(o=>{o.id===e.id&&(console.log("input id:",e.id,"\rtodo:",o),o.overdue=!0,o.overdueTime=m().format())}),h(t),y.value=!y.value};return(e,t)=>n(i).length?(T(),g("div",ke,[_(se,{name:"flip-list",tag:"ul",class:"container"},{default:L(()=>[(T(!0),g(P,null,ne(n(i),(o,a)=>(T(),g("div",{class:"todoItem",draggable:"true",key:o.id},[_(he,{data:o,onOnRemove:E},null,8,["data"])]))),128))]),_:1})])):(T(),g("div",be,Ie))}});export{Se as default};
//# sourceMappingURL=TodoList-e3074397.js.map
